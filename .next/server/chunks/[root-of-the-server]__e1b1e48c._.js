module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},26613,(e,t,r)=>{t.exports=e.x("@prisma/client-1d59d6c8a5ab316c",()=>require("@prisma/client-1d59d6c8a5ab316c"))},22437,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-8666ad3816cdb996");e.n(t),r()}catch(e){r(e)}},!0),14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},36519,e=>{"use strict";var t=e.i(54799);let r=process.env.ENCRYPTION_KEY||process.env.NEXTAUTH_SECRET||"default-key-change-in-production",a="aes-256-cbc";function n(e){let n=t.default.scryptSync(r,"salt",32),s=t.default.randomBytes(16),i=t.default.createCipheriv(a,n,s),o=i.update(e,"utf8","hex");return o+=i.final("hex"),s.toString("hex")+":"+o}function s(e){let n=t.default.scryptSync(r,"salt",32),s=e.split(":");if(2!==s.length)throw Error("Invalid encrypted token format");let i=Buffer.from(s[0],"hex"),o=s[1],l=t.default.createDecipheriv(a,n,i),d=l.update(o,"hex","utf8");return d+l.final("utf8")}e.s(["decryptToken",()=>s,"encryptToken",()=>n])},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},46786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},31309,(e,t,r)=>{"use strict";var a=Object.defineProperty,n=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,o={},l={VercelOidcTokenError:()=>c};for(var d in l)a(o,d,{get:l[d],enumerable:!0});t.exports=((e,t,r,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of s(t))i.call(e,r)||void 0===r||a(e,r,{get:()=>t[r],enumerable:!(o=n(t,r))||o.enumerable});return e})(a({},"__esModule",{value:!0}),o);class c extends Error{constructor(e,t){super(e),this.name="VercelOidcTokenError",this.cause=t}toString(){return this.cause?`${this.name}: ${this.message}: ${this.cause}`:`${this.name}: ${this.message}`}}},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},69072,e=>{"use strict";var t=e.i(36519);class r{accessToken;refreshToken;baseUrl="https://www.googleapis.com/calendar/v3";constructor(e,r){this.accessToken=(0,t.decryptToken)(e),r&&(this.refreshToken=(0,t.decryptToken)(r))}async createEvent(e="primary",t){let r=await fetch(`${this.baseUrl}/calendars/${e}/events`,{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){let e=await r.text();throw Error(`Google Calendar API error: ${r.status} ${r.statusText} - ${e}`)}return r.json()}async updateEvent(e,t,r="primary"){let a=await fetch(`${this.baseUrl}/calendars/${r}/events/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.text();throw Error(`Google Calendar API error: ${a.status} ${a.statusText} - ${e}`)}return a.json()}async deleteEvent(e,t="primary"){let r=await fetch(`${this.baseUrl}/calendars/${t}/events/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${this.accessToken}`}});if(!r.ok){let e=await r.text();throw Error(`Google Calendar API error: ${r.status} ${r.statusText} - ${e}`)}}async listEvents(e,t,r="primary"){let a=new URL(`${this.baseUrl}/calendars/${r}/events`);a.searchParams.set("timeMin",e.toISOString()),a.searchParams.set("timeMax",t.toISOString()),a.searchParams.set("singleEvents","true"),a.searchParams.set("orderBy","startTime");let n=await fetch(a.toString(),{headers:{Authorization:`Bearer ${this.accessToken}`}});if(!n.ok){let e=await n.text();throw Error(`Google Calendar API error: ${n.status} ${n.statusText} - ${e}`)}return(await n.json()).items||[]}async hasConflict(e,t,r="primary"){return(await this.listEvents(e,t,r)).length>0}}async function a(e){let t=process.env.GOOGLE_CLIENT_ID,r=process.env.GOOGLE_CLIENT_SECRET;if(!t||!r)throw Error("Google OAuth credentials not configured");let a=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:t,client_secret:r,refresh_token:e,grant_type:"refresh_token"})});if(!a.ok){let e=await a.text();throw Error(`Token refresh failed: ${a.status} - ${e}`)}return a.json()}e.s(["GoogleCalendarClient",()=>r,"refreshGoogleToken",()=>a])},65807,e=>e.a(async(t,r)=>{try{var a=e.i(72748),n=e.i(69072),s=e.i(36519),i=t([a]);async function o(e,t,r="UTC"){let i=[],l=0;try{let o=await a.prisma.integration.findUnique({where:{userId_platform:{userId:e,platform:"google_calendar"}}});if(!o)return{success:!1,createdEvents:0,errors:["Google Calendar not connected"]};let c=o.accessToken;if(o.expiresAt&&o.expiresAt<new Date){if(!o.refreshToken)return{success:!1,createdEvents:0,errors:["Token expired and no refresh token available"]};let e=await (0,n.refreshGoogleToken)(o.refreshToken);c=(0,s.encryptToken)(e.access_token),await a.prisma.integration.update({where:{id:o.id},data:{accessToken:c,expiresAt:new Date(Date.now()+1e3*e.expires_in)}})}let u=new n.GoogleCalendarClient(c);for(let e of t)try{if(await u.hasConflict(e.startTime,e.endTime)){i.push(`Conflict detected for task "${e.title}" at ${e.startTime.toISOString()}`);continue}let t=await u.createEvent("primary",{summary:e.title,description:e.description,start:{dateTime:e.startTime.toISOString(),timeZone:r},end:{dateTime:e.endTime.toISOString(),timeZone:r},colorId:d(e.priority)});await a.prisma.planTask.update({where:{id:e.taskId},data:{externalId:t.id}}),l++}catch(t){console.error(`Error creating event for task ${e.taskId}:`,t),i.push(`Failed to create event for task "${e.title}": ${t instanceof Error?t.message:"Unknown error"}`)}return{success:0===i.length,createdEvents:l,errors:i}}catch(e){return console.error("Calendar sync error:",e),{success:!1,createdEvents:l,errors:[`Calendar sync failed: ${e instanceof Error?e.message:"Unknown error"}`]}}}async function l(e,t,r,i,o="UTC"){try{let l=await a.prisma.planTask.findUnique({where:{id:t}});if(!l||!l.externalId)return{success:!1,error:"Task not found or not synced to calendar"};let c=await a.prisma.integration.findUnique({where:{userId_platform:{userId:e,platform:"google_calendar"}}});if(!c)return{success:!1,error:"Google Calendar not connected"};let u=c.accessToken;if(c.expiresAt&&c.expiresAt<new Date){if(!c.refreshToken)return{success:!1,error:"Token expired and no refresh token available"};let e=await (0,n.refreshGoogleToken)(c.refreshToken);u=(0,s.encryptToken)(e.access_token),await a.prisma.integration.update({where:{id:c.id},data:{accessToken:u,expiresAt:new Date(Date.now()+1e3*e.expires_in)}})}let p=new n.GoogleCalendarClient(u);return await p.updateEvent(l.externalId,{summary:l.title,description:l.description||void 0,start:{dateTime:r.toISOString(),timeZone:o},end:{dateTime:i.toISOString(),timeZone:o},colorId:d(l.priority)}),await a.prisma.planTask.update({where:{id:t},data:{scheduledStart:r,scheduledEnd:i}}),{success:!0}}catch(e){return console.error("Calendar event update error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to update calendar event"}}}function d(e){return({1:"11",2:"6",3:"5",4:"9"})[e]||"9"}[a]=i.then?(await i)():i,e.s(["syncPlanToCalendar",()=>o,"updateCalendarEvent",()=>l]),r()}catch(e){r(e)}},!1),20823,e=>e.a(async(t,r)=>{try{var a=e.i(51520),n=e.i(18368),s=e.i(72748),i=e.i(65807),o=e.i(49566),l=t([n,s,i]);async function d(e,{params:t}){try{let r=await (0,n.auth)();if(!r||!r.user?.email)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{tasks:l}=await e.json(),d=await s.prisma.user.findUnique({where:{email:r.user.email}});if(!d)return a.NextResponse.json({error:"User not found"},{status:404});let c=await s.prisma.dailyPlan.findUnique({where:{id:t.id},include:{tasks:!0}});if(!c||c.userId!==d.id)return a.NextResponse.json({error:"Plan not found or unauthorized"},{status:404});if(l&&Array.isArray(l))for(let e of l){let{id:t,scheduledStart:r,scheduledEnd:a,completed:n}=e;if(!t)continue;let o={};r&&(o.scheduledStart=new Date(r)),a&&(o.scheduledEnd=new Date(a)),"boolean"==typeof n&&(o.completed=n),await s.prisma.planTask.update({where:{id:t},data:o}),r&&a&&await (0,i.updateCalendarEvent)(d.id,t,new Date(r),new Date(a))}let u=await s.prisma.dailyPlan.findUnique({where:{id:t.id},include:{tasks:{orderBy:{scheduledStart:"asc"}}}});if(u){let e=u.tasks.filter(e=>e.completed).length,t=u.tasks.length;await (0,o.trackCapacityAccuracy)({userId:d.id,predictedCapacity:u.capacityScore,actualCompletionRate:t>0?e/t*100:0,date:u.date,mode:u.mode}).catch(e=>console.error("Opik capacity tracking failed:",e))}return a.NextResponse.json({message:"Plan updated successfully",plan:{id:u.id,date:u.date,capacityScore:u.capacityScore,mode:u.mode,reasoning:u.geminiReasoning,tasks:u.tasks.map(e=>({id:e.id,title:e.title,description:e.description,priority:e.priority,estimatedMinutes:e.estimatedMinutes,scheduledStart:e.scheduledStart,scheduledEnd:e.scheduledEnd,completed:e.completed,goalId:e.goalId}))}},{status:200})}catch(e){return console.error("Plan update error:",e),a.NextResponse.json({error:"Failed to update plan"},{status:500})}}[n,s,i]=l.then?(await l)():l,e.s(["PATCH",()=>d]),r()}catch(e){r(e)}},!1),13098,e=>e.a(async(t,r)=>{try{var a=e.i(43712),n=e.i(60108),s=e.i(31393),i=e.i(72321),o=e.i(1958),l=e.i(84172),d=e.i(30910),c=e.i(46820),u=e.i(49088),p=e.i(2500),h=e.i(37143),f=e.i(46153),m=e.i(69714),w=e.i(87675),y=e.i(2964),x=e.i(93695);e.i(471);var g=e.i(54858),v=e.i(20823),T=t([v]);[v]=T.then?(await T)():T;let C=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/plan/[id]/route",pathname:"/api/plan/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/align/app/api/plan/[id]/route.ts",nextConfigOutput:"",userland:v}),{workAsyncStorage:R,workUnitAsyncStorage:b,serverHooks:S}=C;function k(){return(0,s.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:b})}async function E(e,t,r){C.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/plan/[id]/route";a=a.replace(/\/index$/,"")||"/";let s=await C.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:v,params:T,nextConfig:k,parsedUrl:E,isDraftMode:R,prerenderManifest:b,routerServerContext:S,isOnDemandRevalidate:P,revalidateOnlyGenerated:_,resolvedPathname:A,clientReferenceManifest:O,serverActionsManifest:$}=s,I=(0,d.normalizeAppPath)(a),j=!!(b.dynamicRoutes[I]||b.routes[A]),U=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,E,!1):t.end("This page could not be found"),null);if(j&&!R){let e=!!b.routes[A],t=b.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(k.experimental.adapterPath)return await U();throw new x.NoFallbackError}}let N=null;!j||C.isDev||R||(N=A,N="/index"===N?"/":N);let q=!0===C.isDev||!j,D=j&&!q;$&&O&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:O,serverActionsManifest:$});let G=e.method||"GET",H=(0,o.getTracer)(),M=H.getActiveScopeSpan(),B={params:T,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!k.experimental.authInterrupts},cacheComponents:!!k.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:k.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>C.onRequestError(e,t,a,n,S)},sharedContext:{buildId:v}},L=new c.NodeNextRequest(e),F=new c.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let s=async e=>C.handle(K,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${G} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${G} ${a}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var o,d;let c=async({previousCacheEntry:n})=>{try{if(!l&&P&&_&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(i);e.fetchMetrics=B.renderOpts.fetchMetrics;let o=B.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let d=B.renderOpts.collectedTags;if(!j)return await (0,f.sendResponse)(L,F,a,B.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[y.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,n=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,S),t}},u=await C.handleResponse({req:e,nextConfig:k,cacheKey:N,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:_,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:l});if(!j)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&j||p.delete(y.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,w.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)(L,F,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};M?await d(M):await H.withPropagatedContext(e.headers,()=>H.trace(p.BaseServerSpan.handleRequest,{spanName:`${G} ${a}`,kind:o.SpanKind.SERVER,attributes:{"http.method":G,"http.target":e.url}},d))}catch(t){if(t instanceof x.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,S),j)throw t;return await (0,f.sendResponse)(L,F,new Response(null,{status:500})),null}}e.s(["handler",()=>E,"patchFetch",()=>k,"routeModule",()=>C,"serverHooks",()=>S,"workAsyncStorage",()=>R,"workUnitAsyncStorage",()=>b]),r()}catch(e){r(e)}},!1),92827,e=>{e.v(t=>Promise.all(["server/chunks/00561_@vercel_oidc_dist_10bf8e2b._.js"].map(t=>e.l(t))).then(()=>t(12194)))},73937,e=>{e.v(t=>Promise.all(["server/chunks/00561_@vercel_oidc_dist_b854b462._.js"].map(t=>e.l(t))).then(()=>t(43415)))},23970,e=>{e.v(e=>Promise.resolve().then(()=>e(22734)))},22369,e=>{e.v(e=>Promise.resolve().then(()=>e(88947)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__e1b1e48c._.js.map