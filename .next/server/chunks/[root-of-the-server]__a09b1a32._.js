module.exports=[93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},54799,(e,r,t)=>{r.exports=e.x("crypto",()=>require("crypto"))},26613,(e,r,t)=>{r.exports=e.x("@prisma/client-1d59d6c8a5ab316c",()=>require("@prisma/client-1d59d6c8a5ab316c"))},22437,e=>e.a(async(r,t)=>{try{let r=await e.y("pg-8666ad3816cdb996");e.n(r),t()}catch(e){t(e)}},!0),14747,(e,r,t)=>{r.exports=e.x("path",()=>require("path"))},24361,(e,r,t)=>{r.exports=e.x("util",()=>require("util"))},36519,e=>{"use strict";var r=e.i(54799);let t=process.env.ENCRYPTION_KEY||process.env.NEXTAUTH_SECRET||"default-key-change-in-production",a="aes-256-cbc";function s(e){let s=r.default.scryptSync(t,"salt",32),n=r.default.randomBytes(16),o=r.default.createCipheriv(a,s,n),i=o.update(e,"utf8","hex");return i+=o.final("hex"),n.toString("hex")+":"+i}function n(e){let s=r.default.scryptSync(t,"salt",32),n=e.split(":");if(2!==n.length)throw Error("Invalid encrypted token format");let o=Buffer.from(n[0],"hex"),i=n[1],c=r.default.createDecipheriv(a,s,o),l=c.update(i,"hex","utf8");return l+c.final("utf8")}e.s(["decryptToken",()=>n,"encryptToken",()=>s])},22734,(e,r,t)=>{r.exports=e.x("fs",()=>require("fs"))},46786,(e,r,t)=>{r.exports=e.x("os",()=>require("os"))},31309,(e,r,t)=>{"use strict";var a=Object.defineProperty,s=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,o=Object.prototype.hasOwnProperty,i={},c={VercelOidcTokenError:()=>d};for(var l in c)a(i,l,{get:c[l],enumerable:!0});r.exports=((e,r,t,i)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let t of n(r))o.call(e,t)||void 0===t||a(e,t,{get:()=>r[t],enumerable:!(i=s(r,t))||i.enumerable});return e})(a({},"__esModule",{value:!0}),i);class d extends Error{constructor(e,r){super(e),this.name="VercelOidcTokenError",this.cause=r}toString(){return this.cause?`${this.name}: ${this.message}: ${this.cause}`:`${this.name}: ${this.message}`}}},88947,(e,r,t)=>{r.exports=e.x("stream",()=>require("stream"))},69072,e=>{"use strict";var r=e.i(36519);class t{accessToken;refreshToken;baseUrl="https://www.googleapis.com/calendar/v3";constructor(e,t){this.accessToken=(0,r.decryptToken)(e),t&&(this.refreshToken=(0,r.decryptToken)(t))}async createEvent(e="primary",r){let t=await fetch(`${this.baseUrl}/calendars/${e}/events`,{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok){let e=await t.text();throw Error(`Google Calendar API error: ${t.status} ${t.statusText} - ${e}`)}return t.json()}async updateEvent(e,r,t="primary"){let a=await fetch(`${this.baseUrl}/calendars/${t}/events/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){let e=await a.text();throw Error(`Google Calendar API error: ${a.status} ${a.statusText} - ${e}`)}return a.json()}async deleteEvent(e,r="primary"){let t=await fetch(`${this.baseUrl}/calendars/${r}/events/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${this.accessToken}`}});if(!t.ok){let e=await t.text();throw Error(`Google Calendar API error: ${t.status} ${t.statusText} - ${e}`)}}async listEvents(e,r,t="primary"){let a=new URL(`${this.baseUrl}/calendars/${t}/events`);a.searchParams.set("timeMin",e.toISOString()),a.searchParams.set("timeMax",r.toISOString()),a.searchParams.set("singleEvents","true"),a.searchParams.set("orderBy","startTime");let s=await fetch(a.toString(),{headers:{Authorization:`Bearer ${this.accessToken}`}});if(!s.ok){let e=await s.text();throw Error(`Google Calendar API error: ${s.status} ${s.statusText} - ${e}`)}return(await s.json()).items||[]}async hasConflict(e,r,t="primary"){return(await this.listEvents(e,r,t)).length>0}}async function a(e){let r=process.env.GOOGLE_CLIENT_ID,t=process.env.GOOGLE_CLIENT_SECRET;if(!r||!t)throw Error("Google OAuth credentials not configured");let a=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:r,client_secret:t,refresh_token:e,grant_type:"refresh_token"})});if(!a.ok){let e=await a.text();throw Error(`Token refresh failed: ${a.status} - ${e}`)}return a.json()}e.s(["GoogleCalendarClient",()=>t,"refreshGoogleToken",()=>a])},65807,e=>e.a(async(r,t)=>{try{var a=e.i(72748),s=e.i(69072),n=e.i(36519),o=r([a]);async function i(e,r,t="UTC"){let o=[],c=0;try{let i=await a.prisma.integration.findUnique({where:{userId_platform:{userId:e,platform:"google_calendar"}}});if(!i)return{success:!1,createdEvents:0,errors:["Google Calendar not connected"]};let d=i.accessToken;if(i.expiresAt&&i.expiresAt<new Date){if(!i.refreshToken)return{success:!1,createdEvents:0,errors:["Token expired and no refresh token available"]};let e=await (0,s.refreshGoogleToken)(i.refreshToken);d=(0,n.encryptToken)(e.access_token),await a.prisma.integration.update({where:{id:i.id},data:{accessToken:d,expiresAt:new Date(Date.now()+1e3*e.expires_in)}})}let p=new s.GoogleCalendarClient(d);for(let e of r)try{if(await p.hasConflict(e.startTime,e.endTime)){o.push(`Conflict detected for task "${e.title}" at ${e.startTime.toISOString()}`);continue}let r=await p.createEvent("primary",{summary:e.title,description:e.description,start:{dateTime:e.startTime.toISOString(),timeZone:t},end:{dateTime:e.endTime.toISOString(),timeZone:t},colorId:l(e.priority)});await a.prisma.planTask.update({where:{id:e.taskId},data:{externalId:r.id}}),c++}catch(r){console.error(`Error creating event for task ${e.taskId}:`,r),o.push(`Failed to create event for task "${e.title}": ${r instanceof Error?r.message:"Unknown error"}`)}return{success:0===o.length,createdEvents:c,errors:o}}catch(e){return console.error("Calendar sync error:",e),{success:!1,createdEvents:c,errors:[`Calendar sync failed: ${e instanceof Error?e.message:"Unknown error"}`]}}}async function c(e,r,t,o,i="UTC"){try{let c=await a.prisma.planTask.findUnique({where:{id:r}});if(!c||!c.externalId)return{success:!1,error:"Task not found or not synced to calendar"};let d=await a.prisma.integration.findUnique({where:{userId_platform:{userId:e,platform:"google_calendar"}}});if(!d)return{success:!1,error:"Google Calendar not connected"};let p=d.accessToken;if(d.expiresAt&&d.expiresAt<new Date){if(!d.refreshToken)return{success:!1,error:"Token expired and no refresh token available"};let e=await (0,s.refreshGoogleToken)(d.refreshToken);p=(0,n.encryptToken)(e.access_token),await a.prisma.integration.update({where:{id:d.id},data:{accessToken:p,expiresAt:new Date(Date.now()+1e3*e.expires_in)}})}let u=new s.GoogleCalendarClient(p);return await u.updateEvent(c.externalId,{summary:c.title,description:c.description||void 0,start:{dateTime:t.toISOString(),timeZone:i},end:{dateTime:o.toISOString(),timeZone:i},colorId:l(c.priority)}),await a.prisma.planTask.update({where:{id:r},data:{scheduledStart:t,scheduledEnd:o}}),{success:!0}}catch(e){return console.error("Calendar event update error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to update calendar event"}}}function l(e){return({1:"11",2:"6",3:"5",4:"9"})[e]||"9"}[a]=o.then?(await o)():o,e.s(["syncPlanToCalendar",()=>i,"updateCalendarEvent",()=>c]),t()}catch(e){t(e)}},!1),92827,e=>{e.v(r=>Promise.all(["server/chunks/00561_@vercel_oidc_dist_10bf8e2b._.js"].map(r=>e.l(r))).then(()=>r(12194)))},73937,e=>{e.v(r=>Promise.all(["server/chunks/00561_@vercel_oidc_dist_b854b462._.js"].map(r=>e.l(r))).then(()=>r(43415)))},23970,e=>{e.v(e=>Promise.resolve().then(()=>e(22734)))},22369,e=>{e.v(e=>Promise.resolve().then(()=>e(88947)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a09b1a32._.js.map