{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///Users/ayobami/align/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\nimport { PrismaPg } from '@prisma/adapter-pg'\nimport pg from 'pg'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nfunction createPrismaClient() {\n  const connectionString = process.env.DATABASE_URL\n  if (!connectionString) {\n    throw new Error('DATABASE_URL environment variable is not set')\n  }\n\n  const pool = new pg.Pool({ connectionString })\n  const adapter = new PrismaPg(pool)\n  \n  return new PrismaClient({ adapter })\n}\n\nexport const prisma = globalForPrisma.prisma ?? createPrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,kBAAkB;AAIxB,SAAS;IACP,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IACjD,IAAI,CAAC,kBAAkB;QACrB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,OAAO,IAAI,iKAAE,CAAC,IAAI,CAAC;QAAE;IAAiB;IAC5C,MAAM,UAAU,IAAI,kLAAQ,CAAC;IAE7B,OAAO,IAAI,+MAAY,CAAC;QAAE;IAAQ;AACpC;AAEO,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///Users/ayobami/align/lib/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\nimport Google from \"next-auth/providers/google\";\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\nimport { prisma } from \"./prisma\";\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  adapter: PrismaAdapter(prisma),\n  providers: [\n    Google({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n      authorization: {\n        params: {\n          prompt: \"consent\",\n          access_type: \"offline\",\n          response_type: \"code\",\n        },\n      },\n    }),\n  ],\n  session: {\n    strategy: \"database\",\n  },\n  pages: {\n    signIn: \"/login\",\n    error: \"/login\", // Redirect errors to login page\n  },\n  callbacks: {\n    async session({ session, user }) {\n      if (session.user) {\n        session.user.id = user.id;\n      }\n      return session;\n    },\n  },\n  debug: process.env.NODE_ENV === \"development\", // Enable debug logs in development\n});\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;AACA;AACA;;;;;;;;;AAEO,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,IAAA,2KAAQ,EAAC;IAC1D,SAAS,IAAA,gLAAa,EAAC,kIAAM;IAC7B,WAAW;QACT,IAAA,2KAAM,EAAC;YACL,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;YAC9C,eAAe;gBACb,QAAQ;oBACN,QAAQ;oBACR,aAAa;oBACb,eAAe;gBACjB;YACF;QACF;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;QACR,OAAO;IACT;IACA,WAAW;QACT,MAAM,SAAQ,EAAE,OAAO,EAAE,IAAI,EAAE;YAC7B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,KAAK,EAAE;YAC3B;YACA,OAAO;QACT;IACF;IACA,OAAO,oDAAyB;AAClC"}},
    {"offset": {"line": 224, "column": 0}, "map": {"version":3,"sources":["file:///Users/ayobami/align/lib/opik.ts"],"sourcesContent":["/**\n * Opik Tracking Integration\n * Tracks AI model performance and decisions for demo purposes\n * Requirements: 13.1, 13.2, 13.3\n */\n\nimport { Opik } from 'opik';\n\nlet opikClient: Opik | null = null;\n\n/**\n * Initialize Opik client\n * Requirements: 13.1\n */\nexport function getOpikClient(): Opik | null {\n  // Only initialize if API key is provided\n  if (!process.env.OPIK_API_KEY) {\n    console.warn('OPIK_API_KEY not set - tracking disabled');\n    return null;\n  }\n\n  if (!opikClient) {\n    try {\n      opikClient = new Opik({\n        apiKey: process.env.OPIK_API_KEY,\n        projectName: process.env.OPIK_PROJECT_NAME || 'adaptive-productivity-agent',\n      });\n      console.log('Opik client initialized successfully');\n    } catch (error) {\n      console.error('Failed to initialize Opik client:', error);\n      return null;\n    }\n  }\n\n  return opikClient;\n}\n\n/**\n * Log Gemini AI request and response\n * Requirements: 13.1, 13.2\n */\nexport async function logAIRequest(data: {\n  userId: string;\n  capacityScore: number;\n  mode: string;\n  taskCount: number;\n  prompt: string;\n  response: string;\n  reasoning: string;\n  duration: number;\n  timestamp: Date;\n}): Promise<void> {\n  const client = getOpikClient();\n  if (!client) return;\n\n  try {\n    await client.log({\n      projectName: 'adaptive-productivity-agent',\n      name: 'gemini_plan_generation',\n      input: {\n        userId: data.userId,\n        capacityScore: data.capacityScore,\n        mode: data.mode,\n        taskCount: data.taskCount,\n        prompt: data.prompt,\n      },\n      output: {\n        response: data.response,\n        reasoning: data.reasoning,\n      },\n      metadata: {\n        model: 'gemini-1.5-flash',\n        duration_ms: data.duration,\n        timestamp: data.timestamp.toISOString(),\n      },\n      tags: ['ai-planning', 'gemini', data.mode],\n    });\n\n    console.log('AI request logged to Opik');\n  } catch (error) {\n    console.error('Failed to log AI request to Opik:', error);\n  }\n}\n\n/**\n * Track capacity score accuracy\n * Requirements: 13.3\n */\nexport async function trackCapacityAccuracy(data: {\n  userId: string;\n  predictedCapacity: number;\n  actualCompletionRate: number;\n  date: Date;\n  mode: string;\n}): Promise<void> {\n  const client = getOpikClient();\n  if (!client) return;\n\n  try {\n    // Calculate accuracy score (how well capacity predicted completion)\n    const expectedCompletion = data.predictedCapacity;\n    const actualCompletion = data.actualCompletionRate;\n    const accuracyScore = 100 - Math.abs(expectedCompletion - actualCompletion);\n\n    await client.log({\n      projectName: 'adaptive-productivity-agent',\n      name: 'capacity_accuracy',\n      input: {\n        userId: data.userId,\n        predictedCapacity: data.predictedCapacity,\n        mode: data.mode,\n        date: data.date.toISOString(),\n      },\n      output: {\n        actualCompletionRate: data.actualCompletionRate,\n        accuracyScore,\n      },\n      metadata: {\n        error: Math.abs(expectedCompletion - actualCompletion),\n        timestamp: new Date().toISOString(),\n      },\n      tags: ['capacity-tracking', data.mode],\n      feedbackScores: [\n        {\n          name: 'accuracy',\n          value: accuracyScore / 100,\n          reason: `Predicted ${expectedCompletion}%, actual ${actualCompletion}%`,\n        },\n      ],\n    });\n\n    console.log('Capacity accuracy tracked in Opik');\n  } catch (error) {\n    console.error('Failed to track capacity accuracy in Opik:', error);\n  }\n}\n\n/**\n * Track reasoning chain quality\n * Requirements: 13.2\n */\nexport async function trackReasoningQuality(data: {\n  userId: string;\n  reasoning: string;\n  taskCount: number;\n  userFeedback?: 'helpful' | 'not_helpful';\n  completionRate?: number;\n}): Promise<void> {\n  const client = getOpikClient();\n  if (!client) return;\n\n  try {\n    const qualityScore = calculateReasoningQuality(data.reasoning);\n\n    await client.log({\n      projectName: 'adaptive-productivity-agent',\n      name: 'reasoning_quality',\n      input: {\n        userId: data.userId,\n        taskCount: data.taskCount,\n        reasoningLength: data.reasoning.length,\n      },\n      output: {\n        reasoning: data.reasoning,\n        qualityScore,\n      },\n      metadata: {\n        userFeedback: data.userFeedback,\n        completionRate: data.completionRate,\n        timestamp: new Date().toISOString(),\n      },\n      tags: ['reasoning-quality', 'gemini'],\n      feedbackScores: data.userFeedback\n        ? [\n            {\n              name: 'user_satisfaction',\n              value: data.userFeedback === 'helpful' ? 1 : 0,\n            },\n          ]\n        : undefined,\n    });\n\n    console.log('Reasoning quality tracked in Opik');\n  } catch (error) {\n    console.error('Failed to track reasoning quality in Opik:', error);\n  }\n}\n\n/**\n * Calculate reasoning quality score based on heuristics\n */\nfunction calculateReasoningQuality(reasoning: string): number {\n  let score = 50; // Base score\n\n  // Check for key elements of good reasoning\n  if (reasoning.includes('capacity')) score += 10;\n  if (reasoning.includes('priority') || reasoning.includes('prioritize'))\n    score += 10;\n  if (reasoning.includes('energy') || reasoning.includes('focus')) score += 10;\n  if (reasoning.includes('balance') || reasoning.includes('recovery'))\n    score += 10;\n  if (reasoning.length > 100) score += 10; // Detailed explanation\n\n  return Math.min(100, score);\n}\n\n/**\n * Get Opik dashboard URL for viewing metrics\n * Requirements: 13.4\n */\nexport function getOpikDashboardUrl(): string {\n  const projectName =\n    process.env.OPIK_PROJECT_NAME || 'adaptive-productivity-agent';\n  return `https://www.comet.com/opik/projects/${projectName}`;\n}\n\n/**\n * Export Opik data for analysis\n * Requirements: 13.5\n */\nexport async function exportOpikData(\n  userId: string,\n  startDate: Date,\n  endDate: Date\n): Promise<any[]> {\n  const client = getOpikClient();\n  if (!client) {\n    console.warn('Opik client not available for export');\n    return [];\n  }\n\n  try {\n    // In a real implementation, this would query Opik's API\n    // For now, return a placeholder\n    console.log('Exporting Opik data for user:', userId);\n    return [];\n  } catch (error) {\n    console.error('Failed to export Opik data:', error);\n    return [];\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 417, "column": 0}, "map": {"version":3,"sources":["file:///Users/ayobami/align/app/api/opik/stats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth';\nimport { prisma } from '@/lib/prisma';\nimport { getOpikDashboardUrl } from '@/lib/opik';\n\n// GET /api/opik/stats - Get Opik tracking statistics\nexport async function GET(request: NextRequest) {\n  try {\n    const session = await auth();\n\n    if (!session || !session.user?.email) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Get user from database\n    const user = await prisma.user.findUnique({\n      where: { email: session.user.email },\n    });\n\n    if (!user) {\n      return NextResponse.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    // Get statistics from database\n    const totalPlans = await prisma.dailyPlan.count({\n      where: { userId: user.id },\n    });\n\n    const plansWithTasks = await prisma.dailyPlan.findMany({\n      where: { userId: user.id },\n      include: { tasks: true },\n      orderBy: { date: 'desc' },\n      take: 30, // Last 30 days\n    });\n\n    // Calculate statistics\n    const totalTasks = plansWithTasks.reduce(\n      (sum, plan) => sum + plan.tasks.length,\n      0\n    );\n    const completedTasks = plansWithTasks.reduce(\n      (sum, plan) => sum + plan.tasks.filter((t) => t.completed).length,\n      0\n    );\n    const avgCompletionRate =\n      totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;\n\n    const avgCapacity =\n      plansWithTasks.length > 0\n        ? plansWithTasks.reduce((sum, plan) => sum + plan.capacityScore, 0) /\n          plansWithTasks.length\n        : 0;\n\n    // Mode distribution\n    const modeDistribution = plansWithTasks.reduce(\n      (acc, plan) => {\n        acc[plan.mode] = (acc[plan.mode] || 0) + 1;\n        return acc;\n      },\n      {} as Record<string, number>\n    );\n\n    // Get Opik dashboard URL\n    const opikDashboardUrl = getOpikDashboardUrl();\n\n    return NextResponse.json({\n      stats: {\n        totalPlans,\n        totalTasks,\n        completedTasks,\n        avgCompletionRate: Math.round(avgCompletionRate),\n        avgCapacity: Math.round(avgCapacity),\n        modeDistribution,\n      },\n      opikDashboardUrl,\n      opikEnabled: !!process.env.OPIK_API_KEY,\n    });\n  } catch (error) {\n    console.error('Opik stats error:', error);\n    return NextResponse.json(\n      {\n        error: 'Failed to get Opik statistics',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;;;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,8HAAI;QAE1B,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,EAAE,OAAO;YACpC,OAAO,yJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,yBAAyB;QACzB,MAAM,OAAO,MAAM,kIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,OAAO,QAAQ,IAAI,CAAC,KAAK;YAAC;QACrC;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,yJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,+BAA+B;QAC/B,MAAM,aAAa,MAAM,kIAAM,CAAC,SAAS,CAAC,KAAK,CAAC;YAC9C,OAAO;gBAAE,QAAQ,KAAK,EAAE;YAAC;QAC3B;QAEA,MAAM,iBAAiB,MAAM,kIAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;YACrD,OAAO;gBAAE,QAAQ,KAAK,EAAE;YAAC;YACzB,SAAS;gBAAE,OAAO;YAAK;YACvB,SAAS;gBAAE,MAAM;YAAO;YACxB,MAAM;QACR;QAEA,uBAAuB;QACvB,MAAM,aAAa,eAAe,MAAM,CACtC,CAAC,KAAK,OAAS,MAAM,KAAK,KAAK,CAAC,MAAM,EACtC;QAEF,MAAM,iBAAiB,eAAe,MAAM,CAC1C,CAAC,KAAK,OAAS,MAAM,KAAK,KAAK,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS,EAAE,MAAM,EACjE;QAEF,MAAM,oBACJ,aAAa,IAAI,AAAC,iBAAiB,aAAc,MAAM;QAEzD,MAAM,cACJ,eAAe,MAAM,GAAG,IACpB,eAAe,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,aAAa,EAAE,KAC/D,eAAe,MAAM,GACrB;QAEN,oBAAoB;QACpB,MAAM,mBAAmB,eAAe,MAAM,CAC5C,CAAC,KAAK;YACJ,GAAG,CAAC,KAAK,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,IAAI;YACzC,OAAO;QACT,GACA,CAAC;QAGH,yBAAyB;QACzB,MAAM,mBAAmB,IAAA,6IAAmB;QAE5C,OAAO,yJAAY,CAAC,IAAI,CAAC;YACvB,OAAO;gBACL;gBACA;gBACA;gBACA,mBAAmB,KAAK,KAAK,CAAC;gBAC9B,aAAa,KAAK,KAAK,CAAC;gBACxB;YACF;YACA;YACA,aAAa,CAAC,CAAC,QAAQ,GAAG,CAAC,YAAY;QACzC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,yJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}